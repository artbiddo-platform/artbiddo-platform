(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[301],{852:function(e,s,a){Promise.resolve().then(a.bind(a,3938))},3938:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return j}});var t=a(7437),r=a(2265),l=a(4033),i=a(1232),n=a(6112),c=a(4337);function d(e){let{artworkId:s,currentPrice:a,onBidSubmit:l,userId:i,userName:n}=e,[d,o]=(0,r.useState)(null),[m,x]=(0,r.useState)(a+100),[u,h]=(0,r.useState)([]),[p,j]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,c.io)("http://localhost:3000");return o(e),e.on("connect",()=>{j(!0),console.log("Conectado al servidor de pujas"),e.emit("join-artwork",s)}),e.on("disconnect",()=>{j(!1),console.log("Desconectado del servidor de pujas")}),e.on("bid-update",e=>{h(s=>[e,...s.slice(0,4)])}),e.on("price-changed",e=>{e.artworkId===s&&x(e.newPrice+100)}),()=>{e.emit("leave-artwork",s),e.disconnect()}},[s]);let b=async e=>{if(e.preventDefault(),!i||!n){alert("Debes iniciar sesi\xf3n para pujar");return}if(m<=a){alert("La puja debe ser mayor al precio actual");return}f(!0);try{await l(m)&&d&&(d.emit("new-bid",{artworkId:s,amount:m,userId:i,userName:n}),x(m+100))}catch(e){console.error("Error al enviar puja:",e),alert("Error al enviar la puja")}finally{f(!1)}},N=e=>new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Puja en Tiempo Real"}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(p?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(p?"bg-green-400":"bg-red-400")}),p?"Conectado":"Desconectado"]})}),(0,t.jsxs)("form",{onSubmit:b,className:"mb-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tu puja (€)"}),(0,t.jsx)("input",{type:"number",value:m,onChange:e=>x(Number(e.target.value)),min:a+1,step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Precio actual: €",a.toLocaleString()]})]}),(0,t.jsx)("button",{type:"submit",disabled:!p||g||!i,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:g?"Enviando...":"Hacer Puja"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-lg font-medium mb-3",children:"Pujas Recientes"}),u.length>0?(0,t.jsx)("div",{className:"space-y-2",children:u.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.userName}),(0,t.jsxs)("span",{className:"text-gray-500 ml-2",children:["€",e.amount.toLocaleString()]})]}),(0,t.jsx)("span",{className:"text-sm text-gray-400",children:N(e.timestamp)})]},s))}):(0,t.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No hay pujas recientes"})]})]})}var o=a(9670),m=a(7810),x=a(7347),u=a(6141),h=a(6353),p=a(6445);function j(){let e=(0,l.useParams)(),s=(0,l.useRouter)(),a=e.id,[c,j]=(0,r.useState)(null),[g,f]=(0,r.useState)([]),[b,N]=(0,r.useState)(null),[y,v]=(0,r.useState)(""),[w,S]=(0,r.useState)(!0),[k,P]=(0,r.useState)(!1),[E,D]=(0,r.useState)(""),[T,C]=(0,r.useState)("success");(0,r.useEffect)(()=>{I(),A()},[a]);let I=async()=>{try{let e=await fetch("/api/artworks/".concat(a));if(e.ok){let s=await e.json();j(s.artwork)}let s=await fetch("/api/bids?artworkId=".concat(a));if(s.ok){let e=await s.json();f(e.bids)}}catch(e){console.error("Error cargando datos:",e)}finally{S(!1)}},A=()=>{let e=localStorage.getItem("token"),s=localStorage.getItem("user");e&&s&&N(JSON.parse(s))},L=async e=>{if(!b)return D("Debes iniciar sesi\xf3n para pujar"),C("error"),!1;if(e<=c.currentPrice)return D("La puja debe ser mayor a €".concat(c.currentPrice.toLocaleString())),C("error"),!1;if(e>b.balance)return D("Saldo insuficiente"),C("error"),!1;P(!0),D("");try{let s=localStorage.getItem("token"),t=await fetch("/api/bids",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({artworkId:a,amount:e})}),r=await t.json();if(!t.ok)throw Error(r.error||"Error al realizar la puja");j(s=>s?{...s,currentPrice:e,totalBids:s.totalBids+1}:null);let l={id:r.bid.id,amount:r.bid.amount,status:r.bid.status,createdAt:r.bid.createdAt,user:{name:b.name,avatar:b.avatar||null}};return f(e=>[l,...e]),D("\xa1Puja realizada con \xe9xito!"),C("success"),N(s=>s?{...s,balance:s.balance-e}:null),!0}catch(e){return D(e.message||"Error al realizar la puja"),C("error"),!1}finally{P(!1)}};if(w)return(0,t.jsxs)("div",{className:"min-h-screen bg-secondary-50",children:[(0,t.jsx)(i.default,{}),(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}),(0,t.jsx)(n.Z,{})]});if(!c)return(0,t.jsxs)("div",{className:"min-h-screen bg-secondary-50",children:[(0,t.jsx)(i.default,{}),(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Obra no encontrada"}),(0,t.jsx)("button",{onClick:()=>s.push("/subastas"),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Volver a las subastas"})]})}),(0,t.jsx)(n.Z,{})]});let Z=b?g.find(e=>e.user.name===b.name):null,z=(()=>{if(!c)return"";let e=new Date(c.endDate),s=new Date,a=e.getTime()-s.getTime();if(a<=0)return"Finalizada";let t=Math.floor(a/864e5),r=Math.floor(a%864e5/36e5),l=Math.floor(a%36e5/6e4);return t>0?"".concat(t,"d ").concat(r,"h ").concat(l,"m"):r>0?"".concat(r,"h ").concat(l,"m"):"".concat(l,"m")})(),O=!!c&&new Date<new Date(c.endDate)&&"ACTIVE"===c.status;return(0,t.jsxs)("div",{className:"min-h-screen bg-secondary-50",children:[(0,t.jsx)(i.default,{}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:c.image,alt:c.title,className:"w-full h-96 object-cover rounded-2xl shadow-lg"}),(0,t.jsx)("div",{className:"absolute top-4 right-4",children:(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(O?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:O?"Activa":"Finalizada"})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(o.Z,{className:"w-4 h-4"}),(0,t.jsxs)("span",{children:[c.views," vistas"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4"}),(0,t.jsxs)("span",{children:[c.favorites," favoritos"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(x.Z,{className:"w-4 h-4"}),(0,t.jsxs)("span",{children:[c.totalBids," pujas"]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:c.title}),(0,t.jsxs)("p",{className:"text-xl text-gray-600 mb-4",children:["por ",c.artist]}),(0,t.jsx)("p",{className:"text-gray-700 leading-relaxed",children:c.description})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"A\xf1o"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:c.year})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"T\xe9cnica"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:c.medium})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Dimensiones"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:c.dimensions})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Categor\xeda"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:c.category.name})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Precio inicial:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["€",c.startingPrice.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Precio actual:"}),(0,t.jsxs)("span",{className:"text-2xl font-bold text-primary-600",children:["€",c.currentPrice.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Valor estimado:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["€",c.estimatedValue.toLocaleString()]})]})]}),(0,t.jsx)("div",{className:"bg-primary-50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(u.Z,{className:"w-5 h-5 text-primary-600"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:"Tiempo restante:"})]}),(0,t.jsx)("span",{className:"text-lg font-bold text-primary-600",children:z})]})}),Z&&(0,t.jsx)("div",{className:"bg-blue-50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-blue-800 font-medium",children:"Tu puja actual:"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:["€",Z.amount.toLocaleString()]})]})}),O&&(0,t.jsx)(d,{artworkId:a,currentPrice:c.currentPrice,onBidSubmit:L,userId:null==b?void 0:b.id,userName:null==b?void 0:b.name}),!b&&O&&(0,t.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[(0,t.jsx)("p",{className:"text-yellow-800 mb-2",children:"Debes iniciar sesi\xf3n para pujar"}),(0,t.jsx)("button",{onClick:()=>s.push("/login"),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Iniciar Sesi\xf3n"})]}),!O&&(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:(0,t.jsx)("p",{className:"text-gray-600",children:"Esta subasta ha finalizado"})})]})]}),(0,t.jsxs)("div",{className:"mt-12",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Historial de Pujas"}),(0,t.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pujador"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.user.avatar?(0,t.jsx)("img",{src:e.user.avatar,alt:"",className:"w-8 h-8 rounded-full"}):(0,t.jsx)("span",{className:"text-primary-600 font-medium text-sm",children:e.user.name.charAt(0).toUpperCase()})}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.user.name})})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["€",e.amount.toLocaleString()]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("ACTIVE"===e.status?"bg-green-100 text-green-800":"OUTBID"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"ACTIVE"===e.status?"Activa":"OUTBID"===e.status?"Superada":"Finalizada"})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,h.Z)(new Date(e.createdAt),{addSuffix:!0,locale:p.Z})})]},e.id))})]})})})]})]}),(0,t.jsx)(n.Z,{})]})}}},function(e){e.O(0,[350,612,403,971,938,744],function(){return e(e.s=852)}),_N_E=e.O()}]);