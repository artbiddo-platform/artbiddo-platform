// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  password      String
  role          UserRole  @default(BUYER)
  avatar        String?
  phone         String?
  address       String?
  verified      Boolean   @default(false)
  balance       Float     @default(0)
  totalBids     Int       @default(0)
  totalPurchases Int      @default(0)
  stripeCustomerId String? @unique
  stripeAccountId String? @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  artworks      Artwork[] @relation("SellerArtworks")
  bids          Bid[]
  favorites     Favorite[]
  notifications Notification[]
  messages      Message[] @relation("SenderMessages")
  receivedMessages Message[] @relation("ReceiverMessages")
  transactions  Transaction[]
  tickets       Ticket[]  @relation("UserTickets")
  ticketReplies TicketReply[] @relation("UserTicketReplies")

  @@map("users")
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  description String
  image       String
  artworkCount Int      @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  artworks    Artwork[]

  @@map("categories")
}

model Artwork {
  id             String        @id @default(cuid())
  title          String
  artist         String
  description    String
  categoryId     String
  year           Int
  medium         String
  dimensions     String
  image          String
  startingPrice  Float
  currentPrice   Float
  estimatedValue Float
  status         ArtworkStatus @default(ACTIVE)
  endDate        DateTime
  totalBids      Int           @default(0)
  views          Int           @default(0)
  favorites      Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  category       Category      @relation(fields: [categoryId], references: [id])
  seller         User          @relation("SellerArtworks", fields: [sellerId], references: [id])
  sellerId       String
  bids           Bid[]
  artworkFavorites Favorite[]
  transactions   Transaction[]

  @@map("artworks")
}

model Bid {
  id        String   @id @default(cuid())
  amount    Float
  status    BidStatus @default(ACTIVE)
  createdAt DateTime @default(now())

  // Relations
  artwork   Artwork  @relation(fields: [artworkId], references: [id], onDelete: Cascade)
  artworkId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  @@map("bids")
}

model Favorite {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  // Relations
  artwork   Artwork  @relation(fields: [artworkId], references: [id], onDelete: Cascade)
  artworkId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  @@unique([artworkId, userId])
  @@map("favorites")
}

model Notification {
  id          String           @id @default(cuid())
  type        NotificationType
  title       String
  message     String
  read        Boolean          @default(false)
  createdAt   DateTime         @default(now())

  // Relations
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String

  @@map("notifications")
}

model Message {
  id        String   @id @default(cuid())
  content   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  sender    User     @relation("SenderMessages", fields: [senderId], references: [id], onDelete: Cascade)
  senderId  String
  receiver  User     @relation("ReceiverMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  receiverId String

  @@map("messages")
}

model Transaction {
  id          String            @id @default(cuid())
  type        TransactionType
  amount      Float
  description String
  status      TransactionStatus @default(PENDING)
  createdAt   DateTime          @default(now())

  // Relations
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  artwork     Artwork?          @relation(fields: [artworkId], references: [id])
  artworkId   String?

  @@map("transactions")
}

model Ticket {
  id          String        @id @default(cuid())
  title       String
  description String
  status      TicketStatus  @default(OPEN)
  priority    TicketPriority @default(MEDIUM)
  category    TicketCategory
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  user        User          @relation("UserTickets", fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  replies     TicketReply[]

  @@map("tickets")
}

model TicketReply {
  id        String   @id @default(cuid())
  content   String
  isStaff   Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  ticket    Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  ticketId  String
  user      User     @relation("UserTicketReplies", fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  @@map("ticket_replies")
}

// Enums
enum UserRole {
  BUYER
  SELLER
  ADMIN
  MODERATOR
}

enum ArtworkStatus {
  ACTIVE
  SOLD
  EXPIRED
  PENDING
}

enum BidStatus {
  ACTIVE
  OUTBID
  WON
  CANCELLED
}

enum NotificationType {
  BID_OUTBID
  AUCTION_ENDING
  NEW_ARTWORK
  PAYMENT_SUCCESS
  PAYMENT_FAILED
  SYSTEM
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  BID
  PURCHASE
  REFUND
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TicketCategory {
  TECHNICAL
  PAYMENT
  ACCOUNT
  GENERAL
  BUG_REPORT
  FEATURE_REQUEST
}

// CMS Models
model PageContent {
  id          String   @id @default(cuid())
  page        String   // 'home', 'about', 'contact', etc.
  section     String   // 'hero', 'features', 'footer', etc.
  title       String?
  subtitle    String?
  description String?
  content     String?
  image       String?
  link        String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([page, section])
  @@map("page_content")
}

model SiteSettings {
  id          String   @id @default(cuid())
  key         String   @unique // 'site_name', 'contact_email', 'social_links', etc.
  value       String
  type        String   @default("text") // 'text', 'json', 'boolean', 'number'
  description String?
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("site_settings")
}

model ContentBlock {
  id          String   @id @default(cuid())
  name        String   @unique // 'hero_title', 'about_description', etc.
  title       String?
  content     String
  type        ContentType @default(TEXT)
  metadata    String? // JSON for additional data
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("content_blocks")
}

enum ContentType {
  TEXT
  HTML
  IMAGE
  VIDEO
  JSON
}
